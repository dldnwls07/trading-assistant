# 개발 원칙 및 작업 규칙

이 문서는 개발 중 반드시 지켜야 할 핵심 원칙과 작업 절차를 명시합니다. 모든 기여자는 이 파일을 읽고 동의한 후 작업해주세요.

---

## 핵심 규칙 (업데이트)

1. **변경 전 승인 (Rule 1)**
   - 코드를 수정하기 전에 **"어떻게 바꿀지"** 문서화하여 승인을 받습니다.
   - 문서에는 **변경 목적, 영향 범위, 테스트 계획**을 반드시 포함합니다.

2. **절대 하드코딩 금지 및 상대 경로 준수 (Rule 2)**
   - API 키, DB 접속 정보 등 민감 정보는 `.env` 또는 비밀 관리 서비스(예: GitHub Secrets)에 보관하고, `.gitignore`에 등록합니다.
   - **설정과 상수는 코드에서 분리**하여 `config/settings.yaml` 또는 `settings.py`를 사용합니다.
   - **(추가)** 프로젝트 내의 모든 파일/폴더 경로는 **상대 경로(Relative Path)** 를 사용해야 합니다. 예: `os.path.join(os.getcwd(), 'data')` 대신 `Path(BASE_DIR) / 'data'` 또는 `'./data/list.csv'` 형태 사용. 이는 개발 환경이 바뀌어도 프로그램이 즉시 동작하도록 보장합니다.

3. **모듈화 및 상호 의존성 검사 (Rule 3)**
   - 기능별로 폴더/파일을 분리합니다. 권장 레이어:
     - **Data Layer (`src/data/`)**: API 호출, 수집기, 데이터 전처리
     - **Logic / Agent Layer (`src/agents/`)**: LLM 프롬프트, 전략, 분석 로직
     - **Interface Layer (`src/ui/`)**: CLI, Streamlit, Chrome 확장 연동 코드
     - **Utils (`src/utils/`)**: 공통 함수, 날짜/시간 변환 등
   - **(추가)** 연쇄 오류 검사: 하나의 파일이나 함수를 수정할 때, 그 변경을 참조하거나 의존하는 다른 파일들(Import 관계 등)을 전수 검사하여 전체 시스템 정합성을 유지합니다.

---

## 📋 수정된 규칙 적용 사례 (예시)

### 상대 경로 적용 시:
- 나쁨: `C:/Users/Admin/Desktop/StockProject/data/list.csv` (내 컴퓨터에서만 작동)
- 좋음: `./data/list.csv` 또는 `BASE_DIR / 'data' / 'list.csv'`

### 연쇄 오류 검사 적용 시:
- 예: `src/data/collector.py`에서 함수 이름을 변경했다면, 이를 호출하는 `src/agents/analyst.py`와 `src/ui/dashboard.py`의 코드를 함께 수정하고 정상 동작을 확인해야 합니다.

---

4. **데이터 무결성 및 로깅 (Rule 4 - 신규)**
   - 수집된 주식 데이터는 검증 로직을 통과해야 합니다(예: 결측치, 음수 가격, 극단치 검사 등).
   - 모든 에이전트의 의사결정(사용한 데이터, 프롬프트, 출력 등)은 `logs/`에 기록하여 추후 감사·분석이 가능하도록 합니다.

---

## PR 및 커밋 규칙 (보완)
- 커밋 접두어 규칙 권장: `feat:`, `fix:`, `docs:`, `refactor:`, `test:`, `chore:`
- **AI 프롬프트 변경 시** 커밋/PR 제목에 `prompt:` 접두어 사용(예: `prompt: update earnings analysis prompt`)
- PR 본문에 변경 목적, 주요 파일, 테스트 방법, 리뷰어 요청사항을 포함하세요.
- 대규모 변경(데이터 스키마, 아키텍처)은 설계 문서를 첨부하고 사전 리뷰를 받습니다.

---

## 검사 및 자동화
- `pre-commit` 훅(black,isort,flake8,detect-secrets)을 활성화하여 코드 스타일과 시크릿을 자동 검사합니다.
- CI 파이프라인은 린트, 테스트, 시크릿 스캔, 간단한 통합 검증을 포함해야 합니다.

---

## 변경 제안 템플릿 (Rule 1 / AI 에이전트 최적화)
- 제목:
- 목적:
- AI 프롬프트 변경 여부: (예/아니오)
- 영향 범위: (수정할 파일/모듈 목록)
- 구현 계획:
- 테스트 계획: (특히 데이터 무결성 테스트 포함)
- 롤백 계획:

> 주의: 프롬프트 변경은 에이전트의 동작을 근본적으로 바꿀 수 있으므로 별도의 검증 및 샌드박스 테스트가 필요합니다.

---

## 권장 프로젝트 구조 (Rule 3 적용 예시)
```text
project-root/
├── .env                # API 키 (Git 제외)
├── .gitignore          # 제외 설정
├── requirements.txt    # 의존성 패키지
├── config/             # 종목 리스트 및 설정값
│   └── settings.yaml
├── src/                # 메인 소스코드
│   ├── data/           # yfinance, 수집기, 전처리
│   ├── agents/         # LLM 프롬프트 및 분석 로직
│   ├── ui/             # CLI 또는 Streamlit/GUI 코드
│   └── utils/          # 공통 함수 (날짜 계산 등)
├── logs/               # 실행 로그 및 에이전트 판단 근거
├── tests/              # 유닛 테스트
└── docs/               # 설계 문서 및 운영 가이드
```

---

## 유지보수 팁
- 문서는 코드 변경과 함께 반드시 업데이트하세요(README, PROJECT_PLAN, SECURITY 등).
- 테스트 케이스는 데이터 관련 경계 조건(결측값, 이상치)까지 포함하도록 작성하세요.

감사합니다. 이 규칙은 프로젝트의 안정성과 확장성에 매우 중요하므로 반드시 준수해 주세요.
