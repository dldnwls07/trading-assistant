# 🔒 보안 및 코드 품질 개선 플랜
## 2026-02-07 분석 결과

---

## 🚨 **긴급 보안 문제 (즉시 조치 필요)**

### 1. 보안 핵심 가이드
- **Alpaca API 제거**: 우리는 매매 기능이 없는 보조 도구이므로 Alpaca API 사용을 중단하고 관련 코드를 제거하였습니다.
- **HF_TOKEN 관리**: Hugging Face 토큰은 반드시 `.env`에서만 관리하며 절대로 소스코드에 커밋하지 않습니다.
- **DB 경로**: 하드코딩된 경로를 제거하고 `config.py`에서 중앙 관리합니다.

### 2. HuggingFace 토큰 노출 [중요]
- **위치**: `.env` 파일 20번째 줄
- **문제**: HF_TOKEN 값이 노출됨
- **조치**:
  - [ ] 토큰 재발급 권장
  - [ ] `.env.example` 파일 생성하여 템플릿 제공
- **상태**: ⏳ 대기중

---

## ⚠️ **하드코딩 문제**

### 3. DB 파일명 하드코딩 [중요]
- **위치**: 6개 파일에서 발견
  - `src/data/storage.py` (라인 52)
  - `src/ui/overlay.py` (라인 146)
  - `verify_parser.py`, `verify_analyst.py`, `test_markets.py`, `test_full.py`
- **문제**: `"trading_assistant.db"` 문자열 반복 사용
- **조치**:
  - [ ] 환경변수 또는 설정 파일로 이동
  - [ ] `config/settings.py` 생성
- **상태**: ⏳ 대기중

### 4. UI 색상/스타일 하드코딩 [낮음]
- **위치**: `src/ui/overlay.py`
- **문제**: `'#1a1a2e'`, `'#16213e'` 등 색상 코드 반복
- **조치**:
  - [ ] 스타일 상수 분리
- **상태**: ⏳ 대기중

---

## 🔧 **효율성 문제**

### 5. DataStorage 중복 인스턴스 생성 [중요]
- **위치**: `src/ui/overlay.py`, `src/data/collector.py`, `src/data/parser.py`
- **문제**: 각 모듈에서 DataStorage를 별도로 생성 → 메모리 낭비, 세션 충돌 가능
- **조치**:
  - [ ] 싱글톤 패턴 적용 또는 의존성 주입
- **상태**: ⏳ 대기중

### 6. 중복 sys.path 조작 [낮음]
- **위치**: `src/ui/overlay.py` (라인 13-14)
- **문제**: sys.path.append() 2회 호출
- **조치**:
  - [ ] 한 번만 호출하도록 정리
- **상태**: ⏳ 대기중

### 7. 한글 깨짐 (UTF-8 인코딩) [중요]
- **위치**: 터미널 출력, 차트 이모지
- **문제**: Windows cp949 인코딩과 UTF-8 충돌
- **조치**:
  - [ ] 차트에서 이모지 제거하고 텍스트로 대체
  - [ ] 로깅에 UTF-8 강제 설정
- **상태**: ⏳ 대기중

---

## 📋 **SQLAlchemy 보안 검토**

### 8. SQL Injection 위험 [안전]
- **분석 결과**: ORM 메서드만 사용 중, raw SQL 없음
- **상태**: ✅ 통과

### 9. 세션 관리 [주의]
- **위치**: `src/data/storage.py`
- **문제**: `finally`에서 `session.close()`를 호출하지만, 
  context manager 사용이 더 안전
- **조치**:
  - [ ] with 문으로 세션 관리 개선
- **상태**: ⏳ 대기중

---

## 📁 **불필요한 파일**

### 10. 빈 파일 [낮음]
- **위치**: `src/main.py` (0 bytes)
- **조치**:
  - [ ] 삭제 또는 내용 추가
- **상태**: ⏳ 대기중

---

## ✅ **진행 상황 체크리스트**

| # | 항목 | 우선순위 | 상태 |
|---|------|---------|------|
| 1 | Alpaca API 완전 제거 | 🔴 긴급 | ✅ 완료 |
| 2 | 타임프레임(15분/1시간/1일) 지원 | 🟠 중요 | ✅ 완료 |
| 3 | 차트 패턴 감지 로직 (쌍바닥 등) | 🟠 중요 | ⏳ 진행 중 |
| 4 | 설정 파일 생성 (config.py) | 🟠 중요 | ✅ 완료 |
| 5 | DB 경로 환경변수 이동 | 🟠 중요 | ✅ 완료 |
| 6 | DataStorage 싱글톤 적용 | 🟠 중요 | ✅ 완료 |
| 7 | 한글 깨짐 수정 | 🟠 중요 | ✅ 완료 |
| 8 | 세션 관리 개선 | 🟡 보통 | ✅ 완료 |
| 9 | UI 스타일 상수 분리 | 🟢 낮음 | ✅ 완료 |

---

**마지막 업데이트**: 2026-02-07 23:15

---

## 📝 **사용자 조치 필요 사항**

### Alpaca API 키 재발급 (긴급)
1. [Alpaca Dashboard](https://app.alpaca.markets/) 접속
2. API Keys 메뉴에서 기존 키 삭제
3. 새 키 생성 (Paper Trading)
4. `.env` 파일에 새 키 입력

### HuggingFace 토큰 (권장)
- 현재 토큰이 공개되었으므로 재발급 권장
- [HuggingFace Token Settings](https://huggingface.co/settings/tokens)
